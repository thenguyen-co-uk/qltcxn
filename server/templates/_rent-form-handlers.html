<script defer>
    $(document).ready(function () {
        $('#week-commence').fdatepicker({
            format: 'dd/mm/yyyy'
        });
        $('#rent-due').fdatepicker({
            format: 'dd/mm/yyyy'
        });
        $('#payment-date').fdatepicker({
            format: 'dd/mm/yyyy'
        });
    });

    function toggleLockAndUnlockForm(flag = false) {
        $(".rent-property-updatable input").prop("readonly", flag);
        $(".rent-property-updatable textarea").prop("readonly", flag);
    }

    function saveChanges() {
        const URL = "/rent/update/" + $('#_id').val();
        const updated = {
            'tenant_id': $('#tenant-id').val(),
            'week_commence': $('#week-commence').val(),
            'rent_due': $('#rent-due').val(),
            'payment_date': $('#payment-date').val(),
            'standing_order': $('#standing-order').val(),
            'extra': $('#extra').val(),
            'notes': $('#notes').val()
        };
        console.log(updated);
        fetch(URL, {
            method: 'PUT',
            headers: {
                'Accept': 'application/json; charset=utf-8',
                'Content-Type': 'application/json; charset=utf-8'
            },
            body: JSON.stringify(updated)
        }).then(response => {
            if (!response.ok) {
                throw new Error('Network response failed!!!');
            }
            return response.json();
        }).then(data => {
            console.log(data);
        }).catch(error => {
            console.error('Error: ', error);
        });

        toggleLockAndUnlockForm(true);
    }

    $('#btn-action').on('click', function () {
        let val = $(this).val();
        if (val === "Save") {
            saveChanges();
        } else if (val === "Update") {
            toggleLockAndUnlockForm(false);
        }
        val = val === "Update" ? "Save" : "Update";
        $(this).val(val);
    });
</script>